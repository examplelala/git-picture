{"openapi":"3.0.0","info":{"title":"Chatbot API","description":"A RESTful API for chatbot user management and chat history","version":"1.0.0"},"paths":{"/auth/send_code":{"post":{"tags":["Auth"],"summary":"Send Code","operationId":"send_code_auth_send_code_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PhoneSchema"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/login_or_register":{"post":{"tags":["Auth"],"summary":"Login Or Register","operationId":"login_or_register_auth_login_or_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginSchema"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/chat/users/all_chats/":{"get":{"tags":["Chat"],"summary":"Get Chat History","description":"获取用户聊天历史 - 使用llm_zhx模块","operationId":"get_chat_history_chat_users_all_chats__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"session_id","in":"query","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/chat/users/all_chats_without_access_token/":{"post":{"tags":["Chat"],"summary":"Get Chat History Without Access Token","description":"获取用户聊天历史 - 使用POST请求","operationId":"get_chat_history_without_access_token_chat_users_all_chats_without_access_token__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatHistoryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/chat/users/{session_id}/chats":{"delete":{"tags":["Chat"],"summary":"Clear Chat History","description":"清空指定会话的聊天历史 - 使用llm_zhx模块清空MongoDB数据，同时删除PostgreSQL中的会话记录","operationId":"clear_chat_history_chat_users__session_id__chats_delete","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/chat/create_session":{"post":{"tags":["Chat"],"summary":"Create Session","description":"创建新会话并返回流式响应","operationId":"create_session_chat_create_session_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/chat/get_session_list":{"get":{"tags":["Chat"],"summary":"Get Session List","description":"获取用户的会话列表","operationId":"get_session_list_chat_get_session_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/chat/chat_stream":{"post":{"tags":["Chat"],"summary":"Chat Stream","description":"处理聊天流请求","operationId":"chat_stream_chat_chat_stream_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatStreamRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/chat/report/{session_id}":{"get":{"tags":["Chat"],"summary":"获取单个 H5 报告链接 (通过路径参数)","operationId":"get_h5_chat_report__session_id__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","description":"会话ID","title":"Session Id"},"description":"会话ID"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/user/users":{"post":{"tags":["User"],"summary":"Create User","description":"创建新用户","operationId":"create_user_user_users_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/user/users/{id}":{"get":{"tags":["User"],"summary":"Get User","description":"根据ID获取用户信息","operationId":"get_user_user_users__id__get","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","title":"Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/user/change_nickname":{"post":{"tags":["User"],"summary":"Change Nickname","operationId":"change_nickname_user_change_nickname_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserChangeNameRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/user/change_email":{"post":{"tags":["User"],"summary":"Change Email","operationId":"change_email_user_change_email_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserChangeEmailRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/user/change_phone":{"post":{"tags":["User"],"summary":"Change Phone","operationId":"change_phone_user_change_phone_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserChangePhoneRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/user/deactivate":{"post":{"tags":["User"],"summary":"Deactivate","operationId":"deactivate_user_deactivate_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/user/reactivate":{"post":{"tags":["User"],"summary":"Reactivate","operationId":"reactivate_user_reactivate_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIResponseSuccess"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/api/log/{user_id}":{"post":{"tags":["Logs"],"summary":"Push Log To Frontend","description":"实际通过POST请求接收日志信息，并通过WebSocket推送给指定的前端用户。","operationId":"push_log_to_frontend_api_log__user_id__post","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/report/get_report":{"get":{"tags":["Report"],"summary":"Get H5 Report","operationId":"get_h5_report_report_get_report_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"conversation_id","in":"query","required":true,"schema":{"type":"string","description":"会话ID","title":"Conversation Id"},"description":"会话ID"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/report_feedback":{"post":{"tags":["Report&Feedback"],"summary":"Report Feedback","operationId":"report_feedback_report_feedback_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ReportFeedbackRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}}},"components":{"schemas":{"APIResponseSuccess":{"properties":{"code":{"type":"integer","title":"Code","default":200},"message":{"type":"string","title":"Message","default":"Success"},"data":{"anyOf":[{},{"type":"null"}],"title":"Data"}},"type":"object","title":"APIResponseSuccess"},"ChatHistoryRequest":{"properties":{"session_id":{"type":"string","title":"Session Id"},"api_key":{"type":"string","title":"Api Key"}},"type":"object","required":["session_id","api_key"],"title":"ChatHistoryRequest"},"ChatStreamRequest":{"properties":{"session_id":{"type":"string","title":"Session Id"},"messages":{"type":"string","title":"Messages"}},"type":"object","required":["session_id","messages"],"title":"ChatStreamRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginSchema":{"properties":{"phone":{"type":"string","title":"Phone"},"code":{"type":"string","title":"Code"}},"type":"object","required":["phone","code"],"title":"LoginSchema"},"PhoneSchema":{"properties":{"phone":{"type":"string","title":"Phone"}},"type":"object","required":["phone"],"title":"PhoneSchema"},"ReportFeedbackRequest":{"properties":{"session_id":{"type":"string","title":"Session Id","description":"会话ID"},"message":{"type":"string","title":"Message","description":"被举报消息内容"},"reason":{"type":"string","title":"Reason","description":"举报选项/原因类别"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"详细描述","default":""}},"type":"object","required":["session_id","message","reason"],"title":"ReportFeedbackRequest"},"UserChangeEmailRequest":{"properties":{"email":{"type":"string","title":"Email"}},"type":"object","required":["email"],"title":"UserChangeEmailRequest"},"UserChangeNameRequest":{"properties":{"nickname":{"type":"string","title":"Nickname"}},"type":"object","required":["nickname"],"title":"UserChangeNameRequest"},"UserChangePhoneRequest":{"properties":{"phone":{"type":"string","title":"Phone"}},"type":"object","required":["phone"],"title":"UserChangePhoneRequest"},"UserCreate":{"properties":{"phone":{"type":"string","title":"Phone"}},"type":"object","required":["phone"],"title":"UserCreate"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"OAuth2PasswordBearer":{"type":"oauth2","flows":{"password":{"scopes":{},"tokenUrl":"/auth/login_or_register"}}}}}}